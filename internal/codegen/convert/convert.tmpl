// Code generated by "model-garage" DO NOT EDIT.
package {{ .PackageName }}

var (
	// errInvalidType is returned when a field is not of the expected type or not found.
	errInvalidType = errors.New("invalid type")
)

// IsInvalidType returns true if the error is of type errInvalidType.
func IsInvalidType(err error) bool {
	return errors.Is(err, errInvalidType)
}


// FromData creates a new {{ .ModelName }} from a map of data. Using defined conversion functions.
// If skipNotFound is true, the function will not return an error if a key is not found. 
// instead the field will be set to the zero value of the type.
func FromData(jsonData []byte) (*{{ .ModelName }}, error) {
	{{ $varName := lower .ModelName -}}
	var {{ $varName }} {{ .ModelName -}}
{{ $first := true -}}
{{- range $idx, $sig := .Signals }}
	{{ if not $sig.Conversion }} {{ continue }} {{ end -}}
	{{ if $first -}}
	var errs error
	var err error
	var result gjson.Result
	{{ $first = false }} {{ end }}

	// convert {{ $sig.Conversion.OriginalName }} to {{ $sig.GOName }}
	result = gjson.GetBytes(jsonData, "{{ $sig.Conversion.OriginalName }}")
	if result.Exists() {
	{{ if $sig.Conversion.IsArray -}}
		if result.IsArray() {
			slice{{ $sig.GOName}} := make([]{{ $sig.Conversion.OriginalType }}, len(result.Array()))
			for i, res := range result.Array() {
				v, ok := res.Value().({{ $sig.Conversion.OriginalType }})
				if ok{
					slice{{ $sig.GOName}}[i] = v
				} else {
					errs = errors.Join(errs, fmt.Errorf("%w, field '{{ $sig.Conversion.OriginalName }}' array element %d is not of type '{{ $sig.Conversion.OriginalType }}' got '%v' of type '%T'", errInvalidType, i, res.Value(), res.Value()))
				}
			}
			{{ $varName }}.{{ $sig.GOName }}, err = {{ convertName $sig }}(slice{{ $sig.GOName}} )
			if err != nil {
				errs = errors.Join(errs, fmt.Errorf("failed to convert '{{ $sig.Conversion.OriginalName }}': %w", err))
			}
		} else {
			errs = errros.Join(errs, fmt.Errorf("%w, field '{{ $sig.Conversion.OriginalName }}' is not an array", errInvalidType))
		}

	{{ else -}}
		val{{ $sig.GOName}}, ok := result.Value().({{ $sig.Conversion.OriginalType }})
		if ok {
			{{ $varName }}.{{ $sig.GOName }}, err = {{ convertName $sig }}(val{{ $sig.GOName}})
			if err != nil {
				errs = errors.Join(errs, fmt.Errorf("failed to convert '{{ $sig.Conversion.OriginalName }}': %w", err))
			}
		}else {
			errs = errors.Join(errs, fmt.Errorf("%w, field '{{ $sig.Conversion.OriginalName }}' is not of type '{{ $sig.Conversion.OriginalType }}' got '%v' of type '%T'", errInvalidType, result.Value(),result.Value()))
		}
	{{ end -}}
	}
{{- end }}
	return &{{ $varName }}, errs
}
