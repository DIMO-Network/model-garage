// Code generated by github.com/DIMO-Network/model-garage DO NOT EDIT.
package teslatelem

import (
	"github.com/teslamotors/fleet-telemetry/protos"
	"google.golang.org/protobuf/proto"
)

type Value_StringValue = protos.Value_StringValue

func SignalsFromPayload(baseSignal vss.Signal, data []byte) ([]vss.Signal, []error) {
	var pl protos.Payload
	if err := proto.Unmarshal(data, &pl); err != nil {
		return nil, []error{err}
	}

	ts := pl.GetCreatedAt().AsTime()
	ret := make([]vss.Signal, 0)
	var retErrs []error

	for _, data := range pl.GetData() {
		switch data.Key.String() {
		{{- range $i, $origInfo := .OriginalNames }}
		case "{{ $origInfo.Name }}":
			{{- range $j, $sig := $origInfo.Signals }}
			val{{ $j }}, err := {{ $sig.GOName }}FromV2Data(data.GetValue())
			if err != nil {
				retErrs = append(retErrs, fmt.Errorf("failed to convert '{{ $origInfo.Name }}': %w", err))
			} else {
				sig := vss.Signal{
					TokenID: baseSignal.TokenID,
					Timestamp: ts,
					Source: baseSignal.Source,
					Name: "{{ $sig.JSONName }}",
				}
				sig.SetValue(val{{ $j }})
				ret = append(ret, sig)
			}
			{{- end }}
		{{ end }}
		}
	}

	return ret, retErrs
}

{{- range $i, $sig := .Signals }}
// {{ $sig.GOName }}FromData converts the given JSON data to a {{ $sig.GOType }}.
func {{ .GOName }}FromV2Data(result *protos.Value) (ret {{ .BaseGoType }}, err error) {
    var errs error
	{{- range $j, $conv := .Conversions }}
	val{{ $j }}, ok := result.Value().(*protos.{{ $conv.OriginalType }})
	if ok {
		ret, err = To{{ $sig.GOName }}{{ $j }}(val{{ $j }})
		if err == nil {
			return ret, nil
		}
		errs = errors.Join(errs, fmt.Errorf("failed to convert '{{ $conv.OriginalName }}': %w", err))
	}
	{{ else -}}

	{{- end }}

    return ret, errs
}
{{- end }}